{% extends "teachers/base.html" %}
{% load static %}

<title>
    {% block title %}
        Quizzes
    {% endblock %}
</title>

{% block content %}

<div class="container my-2">
    <div id="coursediv">
        <div id="grades-wrapper">
            <br/>
            <h2> Grades: </h2>

        </div>
        <br/>
            <!-- Sorting buttons -->
            <div>
                <button onclick="sortScores('asc')">Sort Ascending</button>
                <button onclick="sortScores('desc')">Sort Descending</button>
                
            </div>
            <br/>
            <div>
                <strong>Highest Score:</strong> {{ highest_score }}%
            </div>
            <div>
                <strong>Lowest Score:</strong> {{ lowest_score }}%
            </div>
            <div>
                <strong>Average Score:</strong> {{ average_score }}%
            </div>
            <br/>

            <div class="card-columns" style="padding: 10px; margin: 20px;">
                <div class="card" align="centre " style="width: 50rem; border:5px black solid">
                    <div class="card-body">

                        <div class="container text-left.">
                            <div class="row">
                            <div class="col">
                                <strong>Students</strong>
                            </div>
                            <div class="col">
                                
                                <strong>Usernames</strong>
                            </div>
                            <div class="col">
                                <strong>Grades</strong>
                            </div>
                            <div class="col">
                                <strong>Letter Grade</strong>
                            </div>
                            <div class="col">
                                <strong>Attempt(s)</strong>
                            </div>
                            </div>
                
                            {% for grade in grades %}
                            <div class="row">
                            <div class="col">
                                {{grade.student.first_name}} {{grade.student.last_name}}
                            </div>
                            <div class="col">
                                {{grade.student.username}}
                            </div>
                            <div class="col">
                                {{grade.grade}}%
                            </div>
                            <div class="col">
                                
                                {% if grade.grade >= 90 %}
                                    A 
                                {% elif grade.grade >= 80 %}
                                    B
                                {% elif grade.grade >= 70 %}
                                    C
                                {% elif grade.grade >= 60 %}
                                    D
                                {% else %}
                                    F

                                {% endif %}
                            </div>
                            <div class="col">
                                {{grade.attempts}}
                            </div>
                            </div>
                            {% endfor %}
                
                        </div>
            
                    </div>
                </div>
            </div>
    <hr>
    </div>
    <br/>
    <div id="contentwrapper">
        <div id="content">
            <div id="tagwrapper">
                <h2>Quiz Name: {{quiz.title}}</h2> 
                <br/>
                <a class="tags" href="{% url 'teachers:quiz_view' quiz.id %}">View and Add Questions</a>
                <br/><br/>
                <hr>
            </div>    
        </div>
    </div>
    <br/>

</div>
<script>
    function sortScores(option) {

        console.log('Sorting option:', option);
        
        // Get the current URL
        let currentUrl = window.location.href;

        // Check if there is already a 'sort' parameter in the URL
        let hasSortParam = currentUrl.includes('sort=');

        // Construct the new URL with the sorting option
        let newUrl;
        if (hasSortParam) {
            newUrl = currentUrl.replace(/sort=(asc|desc|highest|lowest|average)/, 'sort=' + option);
        } else {
            newUrl = currentUrl + (currentUrl.includes('?') ? '&' : '?') + 'sort=' + option;
        }

        // Redirect to the new URL
        window.location.href = newUrl;
    }
</script>

{% endblock %}

